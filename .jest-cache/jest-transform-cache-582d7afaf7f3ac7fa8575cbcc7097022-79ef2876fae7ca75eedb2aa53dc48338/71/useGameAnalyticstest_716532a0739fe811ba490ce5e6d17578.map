{"version":3,"sources":["C:\\repos\\family-oriented\\src\\hooks\\__tests__\\useGameAnalytics.test.tsx"],"sourcesContent":["/**\r\n * Enhanced useGameAnalytics Hook Tests\r\n * Updated to use new testing standards with simplified approach\r\n */\r\n\r\nimport { renderHook, act, waitFor } from '@testing-library/react';\r\nimport { useGameAnalytics } from '../useGameAnalytics';\r\nimport { analyticsService } from '@/utils/analyticsService';\r\nimport { SettingsProvider } from '@/context/SettingsContext';\r\n\r\njest.mock('@/utils/analyticsService');\r\n\r\n// Test timeout constants\r\nconst TEST_TIMEOUTS = {\r\n  FAST: 2000,\r\n  MEDIUM: 5000,\r\n  SLOW: 8000\r\n} as const;\r\n\r\n// Test data constants\r\nconst MOCK_DATA = {\r\n  avatarId: '00000000-0000-0000-0000-000000000004',\r\n  gameType: 'numbers' as const,\r\n  sessionId: 'session-123',\r\n  recommendations: [\r\n    { gameId: 'letters', reason: 'Try letters next!', priority: 8, estimatedDifficulty: 'beginner', learningObjectives: [], prerequisitesMet: true }\r\n  ],\r\n  metrics: {\r\n    totalGamesPlayed: 1,\r\n    averageSessionDuration: 60,\r\n    overallCompletionRate: 1,\r\n    skillLevelDistribution: { beginner: 1 },\r\n    subjectPreferences: { Mathematics: 1 },\r\n    learningVelocity: 1,\r\n    engagementScore: 80\r\n  }\r\n} as const;\r\n\r\n// Type the mocked service\r\nconst mockAnalyticsService = analyticsService as jest.Mocked<typeof analyticsService>;\r\n\r\nbeforeEach(() => {\r\n  jest.clearAllMocks();\r\n  \r\n  // Setup default successful mock implementations\r\n  mockAnalyticsService.startGameSession.mockResolvedValue(MOCK_DATA.sessionId);\r\n  mockAnalyticsService.trackEvent.mockResolvedValue(undefined);\r\n  mockAnalyticsService.completeGameSession.mockResolvedValue(undefined);\r\n  mockAnalyticsService.getLearningPathRecommendations.mockResolvedValue(MOCK_DATA.recommendations);\r\n  mockAnalyticsService.getPerformanceMetrics.mockResolvedValue(MOCK_DATA.metrics);\r\n});\r\n\r\n// Cleanup after each test\r\nafterEach(() => {\r\n  jest.resetAllMocks();\r\n});\r\n\r\ndescribe('useGameAnalytics - Enhanced Tests', () => {\r\n  const wrapper = ({ children }: { children: React.ReactNode }) => (\r\n    <SettingsProvider>{children}</SettingsProvider>\r\n  );\r\n\r\n  describe('Session Management', () => {\r\n    it('should start a session successfully', async () => {\r\n      const { result } = renderHook(() => useGameAnalytics({\r\n        gameType: MOCK_DATA.gameType,\r\n        avatarId: MOCK_DATA.avatarId,\r\n        autoTrack: false\r\n      }), { wrapper });\r\n\r\n      // Start session without timeout complexity\r\n      await act(async () => {\r\n        await result.current.startSession();\r\n      });\r\n\r\n      expect(mockAnalyticsService.startGameSession).toHaveBeenCalledWith(\r\n        MOCK_DATA.avatarId,\r\n        MOCK_DATA.gameType,\r\n        expect.any(Object),\r\n        undefined\r\n      );\r\n      expect(result.current.sessionId).toBe(MOCK_DATA.sessionId);\r\n    }, TEST_TIMEOUTS.MEDIUM);\r\n\r\n    it('should handle session start failures gracefully', async () => {\r\n      const testError = new Error('Session start failed');\r\n      mockAnalyticsService.startGameSession.mockRejectedValue(testError);\r\n\r\n      const { result } = renderHook(() => useGameAnalytics({\r\n        gameType: MOCK_DATA.gameType,\r\n        avatarId: MOCK_DATA.avatarId,\r\n        autoTrack: false\r\n      }), { wrapper });\r\n\r\n      // Capture console errors during test\r\n      const consoleSpy = jest.spyOn(console, 'error').mockImplementation(() => {});\r\n\r\n      await act(async () => {\r\n        try {\r\n          await result.current.startSession();\r\n        } catch {\r\n          // Expected to fail\r\n        }\r\n      });\r\n\r\n      expect(result.current.sessionId).toBeNull();\r\n      expect(result.current.isTracking).toBe(false);\r\n      consoleSpy.mockRestore();\r\n    }, TEST_TIMEOUTS.FAST);\r\n  });\r\n\r\n  describe('Event Tracking', () => {\r\n    it('should track question attempts with validation', async () => {\r\n      const { result } = renderHook(() => useGameAnalytics({\r\n        gameType: MOCK_DATA.gameType,\r\n        avatarId: MOCK_DATA.avatarId,\r\n        autoTrack: false\r\n      }), { wrapper });\r\n\r\n      await act(async () => {\r\n        await result.current.startSession();\r\n      });\r\n\r\n      await waitFor(() => {\r\n        expect(result.current.sessionId).toBe(MOCK_DATA.sessionId);\r\n      }, { timeout: TEST_TIMEOUTS.FAST });\r\n\r\n      await act(async () => {\r\n        await result.current.trackQuestionAttempt(true, { \r\n          questionIndex: 0,\r\n          responseTime: 1500\r\n        });\r\n      });\r\n\r\n      expect(mockAnalyticsService.trackEvent).toHaveBeenCalledWith(\r\n        MOCK_DATA.sessionId,\r\n        MOCK_DATA.avatarId,\r\n        'question_answer',\r\n        expect.objectContaining({ \r\n          correct: true, \r\n          questionIndex: 0,\r\n          responseTime: 1500\r\n        })\r\n      );\r\n    }, TEST_TIMEOUTS.MEDIUM);\r\n  });\r\n\r\n  describe('Session Completion', () => {\r\n    it('should complete session and load analytics data', async () => {\r\n      const { result } = renderHook(() => useGameAnalytics({\r\n        gameType: MOCK_DATA.gameType,\r\n        avatarId: MOCK_DATA.avatarId,\r\n        autoTrack: false\r\n      }), { wrapper });\r\n\r\n      await act(async () => {\r\n        await result.current.startSession();\r\n      });\r\n\r\n      await waitFor(() => {\r\n        expect(result.current.isTracking).toBe(true);\r\n      }, { timeout: TEST_TIMEOUTS.FAST });\r\n\r\n      await act(async () => {\r\n        await result.current.completeSession(90);\r\n      });\r\n\r\n      expect(mockAnalyticsService.completeGameSession).toHaveBeenCalledWith(\r\n        MOCK_DATA.sessionId,\r\n        90,\r\n        expect.any(Number),\r\n        expect.any(Number)\r\n      );\r\n\r\n      await waitFor(() => {\r\n        expect(result.current.recommendations).toEqual(MOCK_DATA.recommendations);\r\n        expect(result.current.performanceMetrics).toEqual(MOCK_DATA.metrics);\r\n      }, { timeout: TEST_TIMEOUTS.MEDIUM });\r\n    }, TEST_TIMEOUTS.SLOW);\r\n  });\r\n}); "],"names":["jest","mock","TEST_TIMEOUTS","FAST","MEDIUM","SLOW","MOCK_DATA","avatarId","gameType","sessionId","recommendations","gameId","reason","priority","estimatedDifficulty","learningObjectives","prerequisitesMet","metrics","totalGamesPlayed","averageSessionDuration","overallCompletionRate","skillLevelDistribution","beginner","subjectPreferences","Mathematics","learningVelocity","engagementScore","mockAnalyticsService","analyticsService","beforeEach","clearAllMocks","startGameSession","mockResolvedValue","trackEvent","undefined","completeGameSession","getLearningPathRecommendations","getPerformanceMetrics","afterEach","resetAllMocks","describe","wrapper","children","SettingsProvider","it","result","renderHook","useGameAnalytics","autoTrack","act","current","startSession","expect","toHaveBeenCalledWith","any","Object","toBe","testError","Error","mockRejectedValue","consoleSpy","spyOn","console","mockImplementation","toBeNull","isTracking","mockRestore","waitFor","timeout","trackQuestionAttempt","questionIndex","responseTime","objectContaining","correct","completeSession","Number","toEqual","performanceMetrics"],"mappings":"AAAA;;;CAGC;AAODA,KAAKC,IAAI,CAAC;;;;;uBAL+B;kCACR;kCACA;iCACA;AAIjC,yBAAyB;AACzB,MAAMC,gBAAgB;IACpBC,MAAM;IACNC,QAAQ;IACRC,MAAM;AACR;AAEA,sBAAsB;AACtB,MAAMC,YAAY;IAChBC,UAAU;IACVC,UAAU;IACVC,WAAW;IACXC,iBAAiB;QACf;YAAEC,QAAQ;YAAWC,QAAQ;YAAqBC,UAAU;YAAGC,qBAAqB;YAAYC,oBAAoB,EAAE;YAAEC,kBAAkB;QAAK;KAChJ;IACDC,SAAS;QACPC,kBAAkB;QAClBC,wBAAwB;QACxBC,uBAAuB;QACvBC,wBAAwB;YAAEC,UAAU;QAAE;QACtCC,oBAAoB;YAAEC,aAAa;QAAE;QACrCC,kBAAkB;QAClBC,iBAAiB;IACnB;AACF;AAEA,0BAA0B;AAC1B,MAAMC,uBAAuBC,kCAAgB;AAE7CC,WAAW;IACT7B,KAAK8B,aAAa;IAElB,gDAAgD;IAChDH,qBAAqBI,gBAAgB,CAACC,iBAAiB,CAAC1B,UAAUG,SAAS;IAC3EkB,qBAAqBM,UAAU,CAACD,iBAAiB,CAACE;IAClDP,qBAAqBQ,mBAAmB,CAACH,iBAAiB,CAACE;IAC3DP,qBAAqBS,8BAA8B,CAACJ,iBAAiB,CAAC1B,UAAUI,eAAe;IAC/FiB,qBAAqBU,qBAAqB,CAACL,iBAAiB,CAAC1B,UAAUW,OAAO;AAChF;AAEA,0BAA0B;AAC1BqB,UAAU;IACRtC,KAAKuC,aAAa;AACpB;AAEAC,SAAS,qCAAqC;IAC5C,MAAMC,UAAU,CAAC,EAAEC,QAAQ,EAAiC,iBAC1D,qBAACC,iCAAgB;sBAAED;;IAGrBF,SAAS,sBAAsB;QAC7BI,GAAG,uCAAuC;YACxC,MAAM,EAAEC,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,kCAAgB,EAAC;oBACnDvC,UAAUF,UAAUE,QAAQ;oBAC5BD,UAAUD,UAAUC,QAAQ;oBAC5ByC,WAAW;gBACb,IAAI;gBAAEP;YAAQ;YAEd,2CAA2C;YAC3C,MAAMQ,IAAAA,UAAG,EAAC;gBACR,MAAMJ,OAAOK,OAAO,CAACC,YAAY;YACnC;YAEAC,OAAOzB,qBAAqBI,gBAAgB,EAAEsB,oBAAoB,CAChE/C,UAAUC,QAAQ,EAClBD,UAAUE,QAAQ,EAClB4C,OAAOE,GAAG,CAACC,SACXrB;YAEFkB,OAAOP,OAAOK,OAAO,CAACzC,SAAS,EAAE+C,IAAI,CAAClD,UAAUG,SAAS;QAC3D,GAAGP,cAAcE,MAAM;QAEvBwC,GAAG,mDAAmD;YACpD,MAAMa,YAAY,IAAIC,MAAM;YAC5B/B,qBAAqBI,gBAAgB,CAAC4B,iBAAiB,CAACF;YAExD,MAAM,EAAEZ,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,kCAAgB,EAAC;oBACnDvC,UAAUF,UAAUE,QAAQ;oBAC5BD,UAAUD,UAAUC,QAAQ;oBAC5ByC,WAAW;gBACb,IAAI;gBAAEP;YAAQ;YAEd,qCAAqC;YACrC,MAAMmB,aAAa5D,KAAK6D,KAAK,CAACC,SAAS,SAASC,kBAAkB,CAAC,KAAO;YAE1E,MAAMd,IAAAA,UAAG,EAAC;gBACR,IAAI;oBACF,MAAMJ,OAAOK,OAAO,CAACC,YAAY;gBACnC,EAAE,OAAM;gBACN,mBAAmB;gBACrB;YACF;YAEAC,OAAOP,OAAOK,OAAO,CAACzC,SAAS,EAAEuD,QAAQ;YACzCZ,OAAOP,OAAOK,OAAO,CAACe,UAAU,EAAET,IAAI,CAAC;YACvCI,WAAWM,WAAW;QACxB,GAAGhE,cAAcC,IAAI;IACvB;IAEAqC,SAAS,kBAAkB;QACzBI,GAAG,kDAAkD;YACnD,MAAM,EAAEC,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,kCAAgB,EAAC;oBACnDvC,UAAUF,UAAUE,QAAQ;oBAC5BD,UAAUD,UAAUC,QAAQ;oBAC5ByC,WAAW;gBACb,IAAI;gBAAEP;YAAQ;YAEd,MAAMQ,IAAAA,UAAG,EAAC;gBACR,MAAMJ,OAAOK,OAAO,CAACC,YAAY;YACnC;YAEA,MAAMgB,IAAAA,cAAO,EAAC;gBACZf,OAAOP,OAAOK,OAAO,CAACzC,SAAS,EAAE+C,IAAI,CAAClD,UAAUG,SAAS;YAC3D,GAAG;gBAAE2D,SAASlE,cAAcC,IAAI;YAAC;YAEjC,MAAM8C,IAAAA,UAAG,EAAC;gBACR,MAAMJ,OAAOK,OAAO,CAACmB,oBAAoB,CAAC,MAAM;oBAC9CC,eAAe;oBACfC,cAAc;gBAChB;YACF;YAEAnB,OAAOzB,qBAAqBM,UAAU,EAAEoB,oBAAoB,CAC1D/C,UAAUG,SAAS,EACnBH,UAAUC,QAAQ,EAClB,mBACA6C,OAAOoB,gBAAgB,CAAC;gBACtBC,SAAS;gBACTH,eAAe;gBACfC,cAAc;YAChB;QAEJ,GAAGrE,cAAcE,MAAM;IACzB;IAEAoC,SAAS,sBAAsB;QAC7BI,GAAG,mDAAmD;YACpD,MAAM,EAAEC,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,kCAAgB,EAAC;oBACnDvC,UAAUF,UAAUE,QAAQ;oBAC5BD,UAAUD,UAAUC,QAAQ;oBAC5ByC,WAAW;gBACb,IAAI;gBAAEP;YAAQ;YAEd,MAAMQ,IAAAA,UAAG,EAAC;gBACR,MAAMJ,OAAOK,OAAO,CAACC,YAAY;YACnC;YAEA,MAAMgB,IAAAA,cAAO,EAAC;gBACZf,OAAOP,OAAOK,OAAO,CAACe,UAAU,EAAET,IAAI,CAAC;YACzC,GAAG;gBAAEY,SAASlE,cAAcC,IAAI;YAAC;YAEjC,MAAM8C,IAAAA,UAAG,EAAC;gBACR,MAAMJ,OAAOK,OAAO,CAACwB,eAAe,CAAC;YACvC;YAEAtB,OAAOzB,qBAAqBQ,mBAAmB,EAAEkB,oBAAoB,CACnE/C,UAAUG,SAAS,EACnB,IACA2C,OAAOE,GAAG,CAACqB,SACXvB,OAAOE,GAAG,CAACqB;YAGb,MAAMR,IAAAA,cAAO,EAAC;gBACZf,OAAOP,OAAOK,OAAO,CAACxC,eAAe,EAAEkE,OAAO,CAACtE,UAAUI,eAAe;gBACxE0C,OAAOP,OAAOK,OAAO,CAAC2B,kBAAkB,EAAED,OAAO,CAACtE,UAAUW,OAAO;YACrE,GAAG;gBAAEmD,SAASlE,cAAcE,MAAM;YAAC;QACrC,GAAGF,cAAcG,IAAI;IACvB;AACF"}